{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport request from \"@/utils/request\";\nexport default {\n  name: \"Todo\",\n  data() {\n    return {\n      newTask: '',\n      tasks: [],\n      editIndex: null,\n      previousTaskName: '',\n      showError: false\n    };\n  },\n  computed: {\n    completedTasksCount() {\n      return this.tasks.filter(task => task && task.completed).length;\n    }\n  },\n  created() {\n    const userId = this.$route.query.userId;\n    if (userId) {\n      this.loadTasks(userId);\n    } else {\n      const user = JSON.parse(sessionStorage.getItem('user') || \"{}\");\n      if (user.id) {\n        this.loadTasks(user.id);\n      }\n    }\n  },\n  methods: {\n    loadTasks(userId) {\n      if (userId) {\n        request.get(`/todo/user/${userId}`).then(res => {\n          this.tasks = res.data || [];\n        });\n      }\n    },\n    addTask() {\n      const user = JSON.parse(sessionStorage.getItem('user') || \"{}\");\n      const userId = this.$route.query.userId || user.id; // 优先使用传递的 userId，否则使用当前登录用户的 userId\n      if (this.newTask.trim()) {\n        const task = {\n          task: this.newTask,\n          completed: false,\n          userId: userId\n        };\n        request.post(\"/todo\", task).then(res => {\n          if (res.code === '0') {\n            this.tasks.push(res.data);\n            this.newTask = '';\n            this.showError = false;\n            this.loadTasks(userId);\n          }\n        });\n      } else {\n        this.showError = true;\n      }\n    },\n    toggleEditState(index, isEditing) {\n      this.tasks[index].isEditing = isEditing;\n      if (isEditing) {\n        this.previousTaskName = this.tasks[index].task;\n      }\n    },\n    editTask(index) {\n      this.toggleEditState(index, true);\n    },\n    saveTask(task) {\n      request.put(\"/todo\", task).then(res => {\n        if (res.code === '0') {\n          this.toggleEditState(this.tasks.indexOf(task), false);\n        }\n      });\n    },\n    cancelEdit(index) {\n      this.tasks[index].task = this.previousTaskName;\n      this.toggleEditState(index, false);\n    },\n    deleteTask(id) {\n      request.delete(`/todo/${id}`).then(res => {\n        if (res.code === '0') {\n          this.tasks = this.tasks.filter(task => task.id !== id);\n        }\n      });\n    },\n    updateTask(task) {\n      request.put(\"/todo\", task);\n    }\n  }\n};","map":{"version":3,"names":["request","name","data","newTask","tasks","editIndex","previousTaskName","showError","computed","completedTasksCount","filter","task","completed","length","created","userId","$route","query","loadTasks","user","JSON","parse","sessionStorage","getItem","id","methods","get","then","res","addTask","trim","post","code","push","toggleEditState","index","isEditing","editTask","saveTask","put","indexOf","cancelEdit","deleteTask","delete","updateTask"],"sources":["D:\\idea\\simple-bms\\vue\\src\\views\\ToDo.vue"],"sourcesContent":["\r\n<template>\r\n  <div>\r\n    <el-card style=\"width: 80%; margin: 20px auto\">\r\n      <div style=\"font-size: 60px; text-align: center;margin: 20px auto; color: cornflowerblue\">待办事项</div>\r\n      <div style=\"margin-bottom: 20px;\">\r\n        <el-input\r\n          v-model=\"newTask\"\r\n          placeholder=\"需要做什么？\"\r\n          class=\"input-field\"\r\n        />\r\n        <el-button type=\"primary\" style=\"height: 40px\" @click=\"addTask\">添加</el-button>\r\n      </div>\r\n      <el-alert v-if=\"showError\" type=\"error\" :closable=\"false\">任务不能为空！</el-alert>\r\n\r\n      <div style=\"font-size: 30px; text-align: center;margin: 10px auto; color: cornflowerblue\">\r\n        已完成 {{ completedTasksCount }} 项，共 {{ tasks.length }} 项\r\n      </div>\r\n\r\n      <div v-for=\"(task, index) in tasks.filter(task => task)\" :key=\"task.id\" class=\"task\" style=\"margin: 10px;\">\r\n        <div class=\"task-row\" style=\"display: flex; align-items: center;\">\r\n          <el-checkbox v-model=\"task.completed\" @change=\"updateTask(task)\" style=\"margin-right: 10px;\" />\r\n          <span class=\"task-name\" v-if=\"!task.isEditing\" style=\"flex: 1;\">{{ task.task }}</span>\r\n          <el-input\r\n              v-if=\"task.isEditing\"\r\n              v-model=\"task.task\"\r\n              class=\"edit-input\"\r\n              style=\"flex: 1; margin-right: 10px;\"\r\n          />\r\n        </div>\r\n\r\n        <div class=\"button-group\" style=\"margin-top: 10px;\">\r\n          <el-button\r\n              v-if=\"!task.isEditing\"\r\n              type=\"primary\"\r\n              @click=\"editTask(index)\"\r\n              style=\"margin-right: 5px;\"\r\n          >\r\n            编辑\r\n          </el-button>\r\n          <el-button\r\n              v-if=\"!task.isEditing\"\r\n              type=\"danger\"\r\n              @click=\"deleteTask(task.id)\"\r\n          >\r\n            删除\r\n          </el-button>\r\n          <el-button\r\n              v-if=\"task.isEditing\"\r\n              type=\"primary\"\r\n              @click=\"saveTask(task)\"\r\n              style=\"margin-right: 5px;\"\r\n          >\r\n            保存\r\n          </el-button>\r\n          <el-button\r\n              v-if=\"task.isEditing\"\r\n              @click=\"cancelEdit(index)\"\r\n          >\r\n            取消\r\n          </el-button>\r\n        </div>\r\n      </div>\r\n    </el-card>\r\n  </div>\r\n          maxlength=\"50\"\r\n          style=\"width: calc(100% - 120px); margin-right: 10px; height: 40px\"\r\n\r\n  <!-- 其他页面内容放在这里 -->\r\n\r\n  <!-- 固定在底部的上传组件 -->\r\n  <div class=\"upload-container\">\r\n    <el-upload\r\n        v-model:file-list=\"fileList\"\r\n        class=\"upload-demo\"\r\n        action=\"https://run.mocky.io/v3/9d059bf9-4660-45f2-925d-ce80ad6c4d15\"\r\n        multiple\r\n        :on-preview=\"handlePreview\"\r\n        :on-remove=\"handleRemove\"\r\n        :before-remove=\"beforeRemove\"\r\n        :limit=\"3\"\r\n        :on-exceed=\"handleExceed\"\r\n    >\r\n      <el-button type=\"primary\">点击上传</el-button>\r\n      <template #tip>\r\n        <div class=\"el-upload__tip\">\r\n          只能上传jpg/png文件，且不超过500KB\r\n        </div>\r\n      </template>\r\n    </el-upload>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport request from \"@/utils/request\";\r\n\r\nexport default {\r\n  name: \"Todo\",\r\n  data() {\r\n    return {\r\n      newTask: '',\r\n      tasks: [],\r\n      editIndex: null,\r\n      previousTaskName: '',\r\n      showError: false,\r\n    };\r\n  },\r\n  computed: {\r\n    completedTasksCount() {\r\n      return this.tasks.filter(task => task && task.completed).length;\r\n    },\r\n  },\r\n  created() {\r\n    const userId = this.$route.query.userId;\r\n    if (userId) {\r\n        this.loadTasks(userId);\r\n    } else {\r\n        const user = JSON.parse(sessionStorage.getItem('user') || \"{}\");\r\n        if (user.id) {\r\n            this.loadTasks(user.id);\r\n        }\r\n    }\r\n  },\r\n  methods: {\r\n    loadTasks(userId) {\r\n        if (userId) {\r\n            request.get(`/todo/user/${userId}`).then(res => {\r\n                this.tasks = res.data || [];\r\n            });\r\n        }\r\n    },\r\n    addTask() {\r\n        const user = JSON.parse(sessionStorage.getItem('user') || \"{}\");\r\n        const userId = this.$route.query.userId || user.id;  // 优先使用传递的 userId，否则使用当前登录用户的 userId\r\n        if (this.newTask.trim()) {\r\n            const task = { task: this.newTask, completed: false, userId: userId };\r\n            request.post(\"/todo\", task).then(res => {\r\n                if (res.code === '0') {\r\n                    this.tasks.push(res.data);\r\n                    this.newTask = '';\r\n                    this.showError = false;\r\n                    this.loadTasks(userId);\r\n                }\r\n            });\r\n        } else {\r\n            this.showError = true;\r\n        }\r\n    },\r\n    toggleEditState(index, isEditing) {\r\n      this.tasks[index].isEditing = isEditing;\r\n      if (isEditing) {\r\n        this.previousTaskName = this.tasks[index].task;\r\n      }\r\n    },\r\n    editTask(index) {\r\n      this.toggleEditState(index, true);\r\n    },\r\n    saveTask(task) {\r\n      request.put(\"/todo\", task).then(res => {\r\n        if (res.code === '0') {\r\n          this.toggleEditState(this.tasks.indexOf(task), false);\r\n        }\r\n      });\r\n    },\r\n    cancelEdit(index) {\r\n      this.tasks[index].task = this.previousTaskName;\r\n      this.toggleEditState(index, false);\r\n    },\r\n    deleteTask(id) {\r\n      request.delete(`/todo/${id}`).then(res => {\r\n        if (res.code === '0') {\r\n          this.tasks = this.tasks.filter(task => task.id !== id);\r\n        }\r\n      });\r\n    },\r\n    updateTask(task) {\r\n      request.put(\"/todo\", task);\r\n    }\r\n  },\r\n};\r\n</script>\r\n\r\n<style>\r\n.task {\r\n  padding: 10px;\r\n  border: 1px solid #ebeef5;\r\n  border-radius: 4px;\r\n  margin-bottom: 10px;\r\n}\r\n.upload-container {\r\n  position: fixed;\r\n  right: 20px;\r\n  bottom: 20px;\r\n  z-index: 1000; /* 确保在其他内容之上 */\r\n  background: #fff;\r\n  padding: 10px;\r\n  border-radius: 4px;\r\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n/* 上传按钮样式 */\r\n.upload-demo {\r\n  text-align: center;\r\n}\r\n\r\n/* 提示文字样式 */\r\n.el-upload__tip {\r\n  margin-top: 7px;\r\n  color: #666;\r\n  font-size: 12px;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}